<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restaurant Menu Manager</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .subtitle {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .content {
            padding: 30px;
        }

        .section {
            margin-bottom: 40px;
        }

        .section-title {
            font-size: 1.5em;
            color: #667eea;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }

        input, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        input:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .menu-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s;
            overflow: hidden;
        }

        .menu-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border-color: #667eea;
        }

        .menu-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 15px;
            display: block;
        }

        .placeholder-img {
            width: 100%;
            height: 200px;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8ec 100%);
            border-radius: 8px;
            margin-bottom: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #999;
            font-size: 1em;
            text-align: center;
        }

        .placeholder-img small {
            font-size: 0.85em;
            margin-top: 5px;
        }

        .debug-info {
            background: #fff3cd;
            border: 1px solid #ffc107;
            color: #856404;
            padding: 10px;
            border-radius: 5px;
            font-size: 0.75em;
            margin-top: 10px;
            word-break: break-all;
            font-family: monospace;
        }

        .menu-card h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.3em;
        }

        .menu-card p {
            color: #666;
            margin-bottom: 10px;
            line-height: 1.5;
        }

        .menu-card .price {
            font-size: 1.5em;
            color: #28a745;
            font-weight: 700;
            margin: 15px 0;
        }

        .menu-card .id-badge {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.85em;
            margin-bottom: 10px;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #667eea;
            font-size: 1.2em;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 1.8em;
            }
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üçΩÔ∏è Restaurant Menu Manager</h1>
            <p class="subtitle">Full CRUD Operations with MongoDB</p>
        </header>

        <div class="content">
            <!-- Alert Messages -->
            <div id="alert" class="alert"></div>

            <!-- CREATE - Add New Menu Item -->
            <div class="section">
                <h2 class="section-title">‚ûï Add New Menu Item</h2>
                <form id="createForm">
                    <div class="form-group">
                        <label for="createName">Item Name *</label>
                        <input type="text" id="createName" required placeholder="e.g., Pasta Carbonara">
                    </div>
                    <div class="form-group">
                        <label for="createDescription">Description *</label>
                        <textarea id="createDescription" required placeholder="Describe the dish..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="createPrice">Price ($) *</label>
                        <input type="number" id="createPrice" step="0.01" required placeholder="0.00">
                    </div>
                    <button type="submit" class="btn btn-primary">Create Menu Item</button>
                </form>
            </div>

            <!-- IMAGE UPLOAD SECTION -->
            <div class="section">
                <h2 class="section-title">üì∏ Upload Image for Menu Item</h2>
                <form id="uploadImageForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="uploadId">Item ID *</label>
                            <input type="number" id="uploadId" required placeholder="Enter menu item ID">
                        </div>
                        <div class="form-group">
                            <label for="imageFile">Select Image *</label>
                            <input type="file" id="imageFile" accept="image/*" required>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">Upload Image</button>
                </form>
                <div id="uploadLoading" class="loading hidden">Uploading image...</div>
            </div>

            <!-- READ - All Menu Items -->
            <div class="section">
                <h2 class="section-title">üìã All Menu Items</h2>
                <button id="refreshBtn" class="btn btn-primary">Refresh Menu</button>
                <div id="loadingAll" class="loading hidden">Loading menu items...</div>
                <div id="menuGrid" class="menu-grid"></div>
            </div>

            <!-- READ - Get Single Menu Item -->
            <div class="section">
                <h2 class="section-title">üîç Get Single Menu Item</h2>
                <form id="getForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="getId">Item ID *</label>
                            <input type="number" id="getId" required placeholder="Enter item ID">
                        </div>
                    </div>
                    <button type="submit" class="btn btn-secondary">Get Item</button>
                </form>
                <div id="loadingSingle" class="loading hidden">Loading item...</div>
                <div id="singleItem"></div>
            </div>

            <!-- UPDATE - Update Menu Item -->
            <div class="section">
                <h2 class="section-title">‚úèÔ∏è Update Menu Item</h2>
                <form id="updateForm">
                    <div class="form-group">
                        <label for="updateId">Item ID to Update *</label>
                        <input type="number" id="updateId" required placeholder="Enter item ID">
                    </div>
                    <div class="form-group">
                        <label for="updateName">New Name *</label>
                        <input type="text" id="updateName" required placeholder="New item name">
                    </div>
                    <div class="form-group">
                        <label for="updateDescription">New Description *</label>
                        <textarea id="updateDescription" required placeholder="New description..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="updatePrice">New Price ($) *</label>
                        <input type="number" id="updatePrice" step="0.01" required placeholder="0.00">
                    </div>
                    <button type="submit" class="btn btn-success">Update Item</button>
                </form>
            </div>

            <!-- DELETE - Delete Menu Item -->
            <div class="section">
                <h2 class="section-title">üóëÔ∏è Delete Menu Item</h2>
                <form id="deleteForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="deleteId">Item ID to Delete *</label>
                            <input type="number" id="deleteId" required placeholder="Enter item ID">
                        </div>
                    </div>
                    <button type="submit" class="btn btn-danger">Delete Item</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        console.log('üöÄ Script loaded!');
        
        const API_URL = 'http://localhost:3000/api/menu-items';
        
        console.log('API_URL:', API_URL);

        // Utility function to show alerts
        function showAlert(message, type) {
            console.log('Alert:', type, message);
            const alert = document.getElementById('alert');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            alert.style.display = 'block';
            setTimeout(() => {
                alert.style.display = 'none';
            }, 5000);
        }

        // READ - Get all menu items
        function getAllMenuItems() {
            console.log('üìã getAllMenuItems() called');
            const loading = document.getElementById('loadingAll');
            const grid = document.getElementById('menuGrid');
            
            loading.classList.remove('hidden');
            grid.innerHTML = '';

            console.log('Fetching from:', API_URL);

            fetch(API_URL)
                .then(response => {
                    console.log('Response status:', response.status);
                    console.log('Response OK:', response.ok);
                    return response.json();
                })
                .then(items => {
                    console.log('‚úÖ Received items:', items);
                    console.log('Number of items:', items.length);
                    
                    loading.classList.add('hidden');
                    
                    if (items.length === 0) {
                        grid.innerHTML = '<p style="text-align:center; color:#666; grid-column: 1 / -1;">No menu items found. Add some items to get started!</p>';
                        return;
                    }

                    items.forEach((item, index) => {
                        console.log(`\n--- Item ${index + 1} ---`);
                        console.log('Full item object:', item);
                        console.log('ID:', item.id);
                        console.log('Name:', item.name);
                        console.log('imageUrl:', item.imageUrl);
                        console.log('imageUrl exists?', !!item.imageUrl);
                        console.log('imageUrl type:', typeof item.imageUrl);
                        console.log('imageUrl length:', item.imageUrl ? item.imageUrl.length : 0);

                        const card = document.createElement('div');
                        card.className = 'menu-card';

                        let imageSection = '';
                        if (item.imageUrl && item.imageUrl.trim() !== '') {
                            console.log(`‚úÖ Creating image tag for: ${item.name}`);
                            imageSection = `
                                <img src="${item.imageUrl}" 
                                     alt="${item.name}"
                                     onload="console.log('‚úÖ Image loaded successfully for: ${item.name}')"
                                     onerror="console.error('‚ùå Image failed to load for: ${item.name}', 'URL:', '${item.imageUrl}'); this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                <div class="placeholder-img" style="display:none;">Image failed to load</div>
                            `;
                        } else {
                            console.log(`‚ùå No imageUrl for: ${item.name}`);
                            imageSection = `<div class="placeholder-img">No image yet<br><small>Upload one!</small></div>`;
                        }

                        card.innerHTML = `
                            ${imageSection}
                            <span class="id-badge">ID: ${item.id}</span>
                            <h3>${item.name}</h3>
                            <p>${item.description}</p>
                            <div class="price">$${item.price.toFixed(2)}</div>
                            <div class="debug-info">
                                <strong>Debug Info:</strong><br>
                                imageUrl: ${item.imageUrl || 'null/undefined'}<br>
                                Type: ${typeof item.imageUrl}<br>
                                Has image: ${!!item.imageUrl}
                            </div>
                        `;
                        grid.appendChild(card);
                    });
                    
                    showAlert(`üìã Loaded ${items.length} menu items`, 'info');
                })
                .catch(error => {
                    console.error('‚ùå Error fetching items:', error);
                    loading.classList.add('hidden');
                    showAlert(`‚ùå Network error: ${error.message}`, 'error');
                });
        }

        // Refresh button
        document.getElementById('refreshBtn').addEventListener('click', function() {
            console.log('Refresh button clicked');
            getAllMenuItems();
        });

        // CREATE
        document.getElementById('createForm').addEventListener('submit', function(e) {
            e.preventDefault();
            console.log('Create form submitted');
            
            const data = {
                name: document.getElementById('createName').value,
                description: document.getElementById('createDescription').value,
                price: parseFloat(document.getElementById('createPrice').value)
            };

            fetch(API_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(result => {
                console.log('Created:', result);
                showAlert(`‚úÖ Menu item "${result.name}" created! ID: ${result.id}`, 'success');
                document.getElementById('createForm').reset();
                getAllMenuItems();
            })
            .catch(error => {
                console.error('Create error:', error);
                showAlert(`‚ùå Error: ${error.message}`, 'error');
            });
        });

        // IMAGE UPLOAD
        document.getElementById('uploadImageForm').addEventListener('submit', function(e) {
            e.preventDefault();
            console.log('Upload form submitted');

            const id = document.getElementById('uploadId').value.trim();
            const fileInput = document.getElementById('imageFile');
            const file = fileInput.files[0];

            if (!id || !file) {
                showAlert('‚ùå Please provide both ID and image file', 'error');
                return;
            }

            const formData = new FormData();
            formData.append('image', file);

            const uploadUrl = `${API_URL}/${id}/upload-image`;
            console.log('Uploading to:', uploadUrl);

            const loading = document.getElementById('uploadLoading');
            loading.classList.remove('hidden');

            fetch(uploadUrl, {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(result => {
                console.log('Upload response:', result);
                loading.classList.add('hidden');
                showAlert(`‚úÖ Image uploaded for item #${id}!`, 'success');
                document.getElementById('uploadImageForm').reset();
                
                setTimeout(() => {
                    console.log('Refreshing after upload...');
                    getAllMenuItems();
                }, 1000);
            })
            .catch(error => {
                console.error('Upload error:', error);
                loading.classList.add('hidden');
                showAlert(`‚ùå Upload error: ${error.message}`, 'error');
            });
        });

        // GET SINGLE
        document.getElementById('getForm').addEventListener('submit', function(e) {
            e.preventDefault();
            console.log('Get single form submitted');
            
            const id = document.getElementById('getId').value;
            const loading = document.getElementById('loadingSingle');
            const container = document.getElementById('singleItem');
            
            loading.classList.remove('hidden');
            container.innerHTML = '';

            fetch(`${API_URL}/${id}`)
                .then(response => response.json())
                .then(item => {
                    console.log('Single item:', item);
                    loading.classList.add('hidden');
                    
                    const imgHtml = item.imageUrl && item.imageUrl.trim() !== ''
                        ? `<img src="${item.imageUrl}" alt="${item.name}" style="width:100%; height:200px; object-fit:cover; border-radius:8px; margin-bottom:15px;">`
                        : `<div class="placeholder-img">No image yet</div>`;
                    
                    container.innerHTML = `
                        <div class="menu-card" style="max-width: 400px; margin-top: 20px;">
                            ${imgHtml}
                            <span class="id-badge">ID: ${item.id}</span>
                            <h3>${item.name}</h3>
                            <p>${item.description}</p>
                            <div class="price">$${item.price.toFixed(2)}</div>
                            <div class="debug-info">imageUrl: ${item.imageUrl || 'null'}</div>
                        </div>
                    `;
                    showAlert(`‚úÖ Found item: ${item.name}`, 'success');
                })
                .catch(error => {
                    console.error('Get error:', error);
                    loading.classList.add('hidden');
                    showAlert(`‚ùå Error: ${error.message}`, 'error');
                });
        });

        // UPDATE
        document.getElementById('updateForm').addEventListener('submit', function(e) {
            e.preventDefault();
            console.log('Update form submitted');
            
            
            const data = {
		        id: document.getElementById('updateId').value,
                name: document.getElementById('updateName').value,
                description: document.getElementById('updateDescription').value,
                price: parseFloat(document.getElementById('updatePrice').value)
            };

            fetch(`${API_URL}/${data.id}`, {
                method: 'PATCH',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(result => {
                console.log('Updated:', result);
                showAlert(`‚úÖ Menu item "${result.name}" updated!`, 'success');
                document.getElementById('updateForm').reset();
                getAllMenuItems();
            })
            .catch(error => {
                console.error('Update error:', error);
                showAlert(`‚ùå Error: ${error.message}`, 'error');
            });
        });

        // DELETE
        document.getElementById('deleteForm').addEventListener('submit', function(e) {
            e.preventDefault();
            console.log('Delete form submitted');
            
            const id = document.getElementById('deleteId').value;
            
            if (!confirm(`Are you sure you want to delete menu item #${id}?`)) {
                return;
            }

            fetch(`${API_URL}/${id}`, {
                method: 'DELETE'
            })
            .then(response => response.json())
            .then(result => {
                console.log('Deleted:', result);
                showAlert(`‚úÖ ${result.message}`, 'success');
                document.getElementById('deleteForm').reset();
                getAllMenuItems();
            })
            .catch(error => {
                console.error('Delete error:', error);
                showAlert(`‚ùå Error: ${error.message}`, 'error');
            });
        });

        // Load on page load
        console.log('Setting up page load listener...');
        window.addEventListener('load', function() {
            console.log('üéâ Page loaded! Fetching menu items...');
            getAllMenuItems();
        });
        
        console.log('‚úÖ All event listeners set up');
    </script>
</body>
</html>
